# reporting-jira-cloud
Script for extracting data from Jira Cloud API's for reporting purposes using a Jira Issues Filter

# Dependencies
- Python 3.9
- See requirements.txt (use: pip install -r requirements.txt)

# Configuration Setup
The Jira authentication settings and label lookup data is stored in jira_conf.yaml

To stop any changes to this file getting back into Git use:
```
# use --no-skip-worktree to undo
git update-index --skip-worktree jira_conf.yaml
```
## Jira authentication
Create an API Token against your Atlassian account and store it somewhere safe:
https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/

Edit jira_conf.yaml and set the url, user and token. These are the values speciific to your Jira instance, example:
```yaml
- jira:
    url: https://your-domain.atlassian.net/
    user: me@example.com
    token: my-api-token
```

## Lookups (labels)
The team and category data is based on specific labels against a Jira issue (ticket). The label used to represent a team should be added to jira_conf.yaml under
the "team" section and the work category under the "category" section. The lookup uses lowercase, so please ensure you add the key in lowercase (e.g. "team1", not "TEAM1).
If tickets are spread over multiple projects (e.g. one team per project), the lowercase Jira project key can also be added in the team section. The tickets labels will
first be used in the lookup, but if there is no match it will then look for the project key taken from the first part of the Jira issue key. So if the key is "XXX-123",
it would look for "xxx" in the "team" section.

Edit jira_conf.yaml and set add the relevant entries to the "team" and "category" sections. The first value (key) should be the label in lowercase and the second value
the value you want to be displayed as, example:
```yaml
- team:
    team1-label: My team
    team2-label: Another team
    team-project-key: Your team
- category:
    _unknown_: Unknown,firebrick
    project: Project,peru
```
The "\_unknown\_" category is used to provide the display text used when no matching category is found. To control the colours used in the bar chart for the graphs generated by report.py, set the colour using a comma after the category display name. Available colour options: https://matplotlib.org/stable/gallery/color/named_colors.html
## Filters
These can also be added to jira_conf.yaml as a lookup, using a more memborable name as ids can be difficult to remember.

Edit jira_conf.yaml and add your filters to the "filter" sections. The first value (key) should be easy to remember name with no spaces and the second value
the id of the filter setup in Jira, example:
```yaml
- filter:
    work_done: 12345
```

# Details
## extract.py

Extracts Jira issue data based on a Jira Filter ID that can be supplied as a parameter or retrieved from jira_conf.yaml

Each search generates a .CSV file in the data folder, using the filter name as a subfolder. To improve performance we currently only request the following fields in the search:
- summary
- status
- created
- resolutiondate
- components
- labels
- issuetype
- customfield_10014 (Epic Key)
- customfield_10023 (Time in Status)
- customfield_10024 (Story Points)

Team and Category resolution is based on labels and driven by the lookup data in jira_conf.yaml. All keys should be lowercase to enable matching.

There are two different column output options, summary and detailed. Summary returns "Key", "Summary", "Category", "Team", "Status", "Created", "Resolved". Detailed column output is only relevant for completed (Done) Jira Issues, so best suited to Jira filters that only retireve resolved issues. Detailed columns include the summary columns, plus "Epic", "Issue Type", "Story Points", "Days Open" and the following status columns that represent the number of days the issue spent in the following status:
- To Do
- In Progress
- Ready to Review
- QA Test
- Ready to Release
- QA Test Dev
- Ready to Promote to Stage (Ready for Stage)
- QA Test Stage
- Ready to Promote to Prod (Ready for Prod)

The days calculation for the status transitions include weekends and is rounded to 2 decimal places. Days Open is the total lead time, between ticket creation and resolution.

The total number of issues extracted, and the name of the file created are output on successful execution. Any unresolved teams will be reported, along with the Jira Issue ID and unresolved categories will just be reported as "Unknown" in the .CSV

## report.py
Uses the underlying code in extract.py to generate a summary column .CSV using a Jira Filter ID, then pivots the data to create a graph (.PNG) for the number of issues completed by a team, grouped by category. An Excel spreadsheet (.XLSX) containing this pivot data is also created. Either the summary or detail column .CSV files generated by extract.py can also be passed in, so it's possible to skip the initial data extraction phase. Any issues that don't have a status of "Done" are not included in the graph or spreadsheet. The team and category labels defined in jira_conf.yaml are used to drive the data displayed, though it is possible to specify which team data is displayed in the graph. On successful completion, the names of the files generated are output.
# Run
Generates a .PNG, .XLSX and .CSV file covering the total number of issues completed, grouped by category, for each team defined in jira_conf.yaml
```python
py report.py 12345
py report.py work_done
```
Generates a .PNG, .XLSX and .CSV file covering the total number of issues completed, grouped by category, for the team(s) specified (these must exist in jira_conf.yaml)
```python
py report.py 12345 "My team"
py report.py work_done "My team,Another team"
```
Generates a .PNG, .XLSX and .CSV file covering the total number of issues completed, grouped by category, for each team defined in jira_conf.yaml
```python
py report.py -f ".//data//Some Filter Name//2021-06//24_SUMMARY.csv"

```
Generates a .PNG, .XLSX and .CSV file covering the total number of issues completed, grouped by category, for the first filter defined in jira_conf.yaml and the team(s) specified (these must exist in jira_conf.yaml)
```python
py report.py -t "My team,Another team"

```
Generates a .PNG, .XLSX and .CSV file covering the total number of issues completed, grouped by category, for the team(s) specified. The input is the file name created by extract.py
```python
py report.py -f ".//data//Another Filter Name//2021-06//24_SUMMARY.csv" "My team"
py report.py -f ".//data//Another Filter Name//2021-06//24_SUMMARY.csv" "My team,Another team"

```
Generates a .CSV file with basic summary columns for the first filter defined in jira_conf.yaml
```python
py extract.py
```
Generates a .CSV file with detailed columns for the filter id or filter defined in jira_conf.yaml
```python
py extract.py 12345
py extract.py work_done
```
Generates a .CSV file with basic summary columns for the filter id or filter defined in jira_conf.yaml
```python
py extract.py -s 12345
py extract.py -s work_done
```
Generates a .CSV file with detailed columns for the filter id or filter defined in jira_conf.yaml
```python
py extract.py -d 12345
py extract.py -d work_done
```